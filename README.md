# poker - Readme

> *本ドキュメントはMarkdown記法にそって記述しています。*

## ◆はじめに
このアプリは、名古屋営業所の[第2回プログラムコンテスト](https://sites.google.com/a/systena.co.jp/nagoya2/ji-shu-li-xiang-shang-tui-jin-wei-yuan-hui/purokon/di2huipurokon)に基づいて作成したアプリです。  
**作成した目的** は、今までの開発経験で得たノウハウの整理と、今後の有望な若手たちに、少しでも参考になればと、気まぐれな気分で作成しました。  
よって、エントリー部門は、レジェンドを考慮した、**ミドルステージ** になります。  
理由は、Joker判定は対応しましたが、COMのA.I部分については、発想と努力による部分で、**作成した目的** から少し外れると思うので、仕様ドロップとし、期待する若手たちに任せることにします（笑）。  


## ◆動作環境

 - OS：macOS 10.13
 - コンパイラ：gcc (Apple LLVM version 9.1.0 (clang-902.0.39.2))
 - Make：GNU Make 3.81

※作成・動作確認環境はMacですが、Linux（Ubuntu）上でも動作確認しています。  
※ただし、Windows環境だけは動作確認できていません。  
※OS依存の実装部分もありますが、対応できるように実装はしています。心配事は、Makefileが通るかわかりません。  

## ◆成果物一覧

```
poker
├── README.md
├── Makefile
├── _project
│   └── Doxyfile
├── doc
│   ├── poker_設計メモ.xlsx
│   └── doxygen
├── include
│   ├── card.h
│   ├── common.h
│   ├── config.h
│   ├── debug.h
│   ├── game.h
│   ├── player.h
│   ├── poker.h
│   ├── system.h
│   └── ui.h
└── src
    ├── card.c
    ├── debug.c
    ├── game.c
    ├── main.c
    ├── player.c
    ├── poker.c
    ├── system.c
    └── ui.c
```

### README.md
 - このファイルです。
### Makefile
 - GNU Make対応のMakefileです。ビルド・実行方法は後述します。
### _project
 - 開発環境に関連のあるファイル格納フォルダ  
 - Doxygen設定ファイルがあります。
### bin
 - make実行後に作成され、pokerアプリの実行ファイルが置かれます。  
### doc
 - 設計書格納フォルダ  
 - 簡単なPokerの役判定の設計メモ（Excel）があります。  
また、Doxygen生成を行うと、docの配下に作成されます。  
### include
 - ヘッダファイル格納フォルダ  
### src
 - ソースファイル格納フォルダ  

## ◆Makefileの実行
以下のコマンドに対応しています。  

 - `make` => ビルドして実行ファイル*poker*をbinフォルダに生成します。
 - `make clean` => cleanします。
 - `make run` => *poker*を実行します。
 - `make doxygen` => ./doc/doxygen/にDoxygenファイルを生成します。
 
 ## 遊び方
 `make run`実行後、画面に表示に従って遊んでください。

## ◆Doxygen
 - 今回は、ソースコードにDoxygenを対応しました。
 - Doxygenファイル生成には、`Doxygen`と`Graphviz`のインストールが必要です。
 - `make doxygen`コマンド実行後に./doc/doxygen/にファイルが出力されるため、*index.html*を開いて参照してください。
 - と言っても、そんなに頑張って書いているわけではないです。


# ＜poker設計概要＞
## ◆全体方針
委員会のルールに基づいて **C言語** にて作成しました。  
しかし、今回のお題は、 **C++** などのオブジェクト指向プログラミングができる言語で作成すると、もっとわかりやすく作成しやすい内容と思います。  
**C言語** でも機能間の依存関係やデータのカプセル化を意識できるように作成したつもりです。  
よって、ファイル名（.c/.h）は1機能=1クラスになるように作成されています。  

## ◆機能一覧

 - Gameクラス
 - UIクラス
 - Playerクラス
 - Cardクラス
 - Pokerクラス
 - Systemクラス
 - Debugクラス

## ◆ Gameクラス
* カードゲームの実施を行います。
* Card・Poker・Player・UIの各クラスを使用します。

## ◆ UIクラス
* ユーザーインターフェースを管理するクラス機能です。
* 今回はコンソール画面を対象にしています。

## ◆ Playerクラス
* ゲームプレイヤーを管理します。
* 対人用・COM用に対応します。
  * 本来は、対人用COM用に継承してインスタンス化して使用したいところです。

==【注意】==
>仕様ドロップ機能があります。COMのA.Iによる自動判別処理が未対応です。  

## ◆ Cardクラス
* トランプのカード情報を取り扱うクラス機能。
* CARD構造体のメンバ変数を保持します。

## ◆ Pokerクラス
* Pokerゲームの管理を行います。
* 役の判定や勝敗を実施します。

==【注意】==
>仕様ドロップ機能があります。同じ役のときの勝敗判定機能が未対応です。 

## ◆ Systemクラス
* システムに依存する機能を管理します。
* 本アプリでは以下の機能を有しています。
  - 乱数生成
  - コンソール画面クリア

==【注意】==
>画面クリア処理は、system関数を使用しており、OSに依存しています。  
MakefileにてOS判別を行っています。  
ただし、Windows環境のみ動作確認できていません。  

## ◆ Debugクラス
* デバッグ出力を管理するクラス機能です
* 出力先はコンソールへのSTDOUTですが、ファイル出力やリングバッファ出力への拡張性をある程度持てるように作成しています

config.hにて、以下の切り替えが可能です  
- Debugクラス自体の有効無効の切り替え
  - CONFIG_ENABLE_DEBUG_PRINT
  - 無効にした場合は、出力コード自体が無効になるため、ROMにも残りません
- 各クラスごとの出力の有効無効の切り替え
  - デバッグ出力用クラスIDごとに切替可能です

## ◆ commonヘッダファイル
* 共通に使用する定義ファイルです。

## ◆ configヘッダファイル
* 実行環境に依存する設定ファイルです。
* 現状は主にDebugクラスの切り替え定義があります。

# ＜poker設計詳細＞
詳細は、ヘッダーファイルとソースファイルを参照してください。  

## ◆最後に

なるべくわかりやすく機能を分割し、お互いが依存関係を意識して作成しています。  
Debugクラスについては、初見ではテクニカルに見える部分もあると思いますが、組み込みの世界では必ず発生する部分になるので、これからの人は是非理解してほしいところです。これが理解できると拡張することが可能になります。  

また、全体方針にも記載しましたが、このようなお題は、オブジェクト指向言語などが対応しやすいですね。  
なので、 **C++** ではそんなに変わらないと思うので、 **Python** や **Ruby** で移植して、どのくらいコードがシンプルになるか試したいところです。  
そうすれば、A.I部分も捗るのではないでしょうか。

以上。